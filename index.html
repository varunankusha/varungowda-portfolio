<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>VarunGowda A P — Portfolio</title>
    <meta name="description" content="Portfolio of VarunGowda A P — Support Analyst with expertise in troubleshooting, SQL, Linux, Docker, and Kubernetes." />
    <meta name="theme-color" content="#0f172a" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="assets/css/styles.css" />
  </head>
  <body>
    <header class="site-header">
      <nav class="nav container" aria-label="Primary">
        <a class="logo" href="#home" aria-label="Go to home">VG</a>
        <button class="nav-toggle" aria-expanded="false" aria-label="Toggle navigation">
          <span></span><span></span><span></span>
        </button>
        <ul class="nav-links">
          <li><a href="#about">About</a></li>
          <li><a href="#gallery">Gallery</a></li>
          <li><a href="#polls">Polls</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </nav>
    </header>

    <main id="home">
      <section class="hero container">
        <div class="hero-copy">
          <h1>Hi, I'm VarunGowda<span class="accent">.</span></h1>
          <p class="subtitle">Support Analyst specializing in troubleshooting, SQL, Linux, Docker, and Kubernetes.</p>
          <div class="cta-row">
            <a class="btn primary" href="#projects">View Projects</a>
            <a class="btn ghost" href="#contact">Contact Me</a>
          </div>
          <div class="meta">
            <a href="tel:+916362213600">+91 63622 13600</a>
            <span aria-hidden="true">·</span>
            <a href="https://www.linkedin.com/in/varun-gowda-a-p-a58820196/" target="_blank" rel="noopener">LinkedIn</a>
            <span aria-hidden="true">·</span>
            <a href="assets/VarunGowda_Resume.pdf" download>Resume</a>
          </div>
        </div>
        <div class="hero-media">
          <img src="assets/img/profile.svg" alt="Portrait of VarunGowda A P" />
        </div>
      </section>

      <section id="about" class="section container">
        <h2>About</h2>
        <p>
          I am a Support Analyst focused on reliable operations and rapid incident resolution. I troubleshoot
          complex issues across infrastructure and applications, and work hands‑on with SQL, Linux, Docker,
          and Kubernetes to keep systems healthy and performant.
        </p>
        <ul class="details">
          <li><strong>Location:</strong> Mandya, India</li>
          <li><strong>Focus:</strong> Production Support, SRE/DevOps, Incident Management</li>
          <li><strong>Stack:</strong> SQL, Linux, Docker, Kubernetes, Bash</li>
          <li><strong>Interests:</strong> Agriculture, Literature, Public Policy, Social Impact</li>
        </ul>
      </section>

             <section id="gallery" class="section container">
         <h2>Gallery</h2>
         <p class="subtitle" style="color:var(--muted); margin-top:-8px;">Add images or videos from the Admin page.</p>
         <div id="status" style="padding: 10px; margin: 10px 0; background: #f0f0f0; border-radius: 4px; font-size: 14px; color: #666;">Loading content...</div>
         <button onclick="forceLocalStorage()" style="margin: 10px 0; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Force localStorage Rendering</button>
         <div id="galleryGrid" class="grid gallery"></div>
       </section>

      <section id="polls" class="section container">
        <h2>Polls</h2>
        <p class="subtitle" style="color:var(--muted); margin-top:-8px;">Create and manage polls from the Admin page.</p>
        <div id="pollsList" class="polls-list"></div>
      </section>

      <section id="contact" class="section container">
        <h2>Contact</h2>
        <p>I'm open to opportunities and collaborations. Drop a message:</p>
        <form class="contact-form" action="https://formspree.io/f/your-id" method="POST">
          <div class="field">
            <label for="name">Name</label>
            <input id="name" name="name" required />
          </div>
          <div class="field">
            <label for="email">Email</label>
            <input id="email" type="email" name="_replyto" required />
          </div>
          <div class="field">
            <label for="message">Message</label>
            <textarea id="message" name="message" rows="5" required></textarea>
          </div>
          <button class="btn primary" type="submit">Send</button>
        </form>
        <p class="meta" style="margin-top:12px;">
          Prefer a quick call? <a href="tel:+916362213600">+91 63622 13600</a>
        </p>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container footer-inner">
        <p>© <span id="year"></span> VarunGowda A P</p>
        <div class="social">
          <a href="https://github.com/your-handle" target="_blank" rel="noopener">GitHub</a>
          <a href="https://www.linkedin.com/in/varun-gowda-a-p-a58820196/" target="_blank" rel="noopener">LinkedIn</a>
          <a href="tel:+916362213600">Call</a>
          <a href="working-admin.html">Admin</a>
        </div>
      </div>
    </footer>

    <script src="assets/js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module">
      import { fetchGallery, fetchPolls, vote } from './assets/js/supabase.js';
      
      const toYouTubeEmbed = (url) => {
        try { const u = new URL(url); if (u.hostname.includes('youtu.be')) { const id = u.pathname.replace('/', ''); return id?`https://www.youtube.com/embed/${id}`:null; } if (u.hostname.includes('youtube.com')) { if (u.pathname.startsWith('/embed/')) return url; const id = u.searchParams.get('v'); return id?`https://www.youtube.com/embed/${id}`:null; } } catch {} return null; };
      const toVimeoEmbed = (url) => { try { const u = new URL(url); if (u.hostname.includes('vimeo.com')) { const id = u.pathname.split('/').filter(Boolean)[0]; return id?`https://player.vimeo.com/video/${id}`:null; } } catch {} return null; };
      
      // Helper function to render gallery items
      function renderGalleryItem(item, container) {
        const wrapper = document.createElement('div');
        wrapper.className = 'gallery-item';
        
        const url = item.storage_url || item.src; // Handle both Supabase and localStorage formats
        const yt = toYouTubeEmbed(url);
        const vi = toVimeoEmbed(url);
        
        if (yt || vi) {
          const el = document.createElement('iframe');
          el.src = yt || vi;
          el.setAttribute('frameborder', '0');
          el.allowFullscreen = true;
          wrapper.appendChild(el);
        } else if (/\.(mp4|webm|ogg)(\?.*)?$/i.test(url)) {
          const v = document.createElement('video');
          v.src = url;
          v.controls = true;
          wrapper.appendChild(v);
        } else {
          const img = document.createElement('img');
          img.src = url;
          img.alt = item.alt || 'Gallery item';
          wrapper.appendChild(img);
        }
        container.appendChild(wrapper);
      }
      
      // Helper function to render poll
      function renderPoll(poll, container) {
        const card = document.createElement('div');
        card.className = 'poll-card';
        
        const title = document.createElement('h3');
        title.textContent = poll.question;
        
        const optionsWrap = document.createElement('div');
        optionsWrap.className = 'poll-options';
        
        const totalVotes = poll.options.reduce((s, o) => s + (o.votes || 0), 0) || 0;
        
                 poll.options.forEach((option, index) => {
           const btn = document.createElement('button');
           const percent = totalVotes ? Math.round((option.votes || 0) * 100 / totalVotes) : 0;
           btn.innerHTML = `${option.text} — ${percent}% (${option.votes || 0})`;
           
           // Check if user has already voted on this poll
           if (!window.USE_SUPABASE) {
             const votedPolls = JSON.parse(localStorage.getItem('votedPolls') || '{}');
             const pollKey = poll.question;
             if (votedPolls[pollKey]) {
               btn.disabled = true;
               btn.style.opacity = '0.6';
               btn.style.cursor = 'not-allowed';
             }
           }
          
                     btn.addEventListener('click', async () => {
             if (window.USE_SUPABASE && poll.id && option.id) {
               try { 
                 await vote(poll.id, option.id); 
                 location.reload(); 
               } catch (e) { 
                 alert('Already voted or error'); 
               }
             } else {
               // Handle localStorage voting with one vote per device
               const votedPolls = JSON.parse(localStorage.getItem('votedPolls') || '{}');
               const pollKey = poll.question; // Use question as unique key
               
               if (votedPolls[pollKey]) {
                 alert('You have already voted on this poll!');
                 return;
               }
               
               const polls = JSON.parse(localStorage.getItem('polls') || '[]');
               const pollIndex = polls.findIndex(p => p.question === poll.question);
               if (pollIndex !== -1) {
                 polls[pollIndex].options[index].votes = (polls[pollIndex].options[index].votes || 0) + 1;
                 localStorage.setItem('polls', JSON.stringify(polls));
                 
                 // Mark this poll as voted
                 votedPolls[pollKey] = true;
                 localStorage.setItem('votedPolls', JSON.stringify(votedPolls));
                 
                 location.reload();
               }
             }
           });
          
          optionsWrap.appendChild(btn);
        });
        
        const bar = document.createElement('div');
        bar.className = 'poll-progress';
        const fill = document.createElement('span');
        const topPercent = totalVotes ? Math.max(...poll.options.map(o => Math.round((o.votes || 0) * 100 / totalVotes))) : 0;
        fill.style.width = `${topPercent}%`;
        bar.appendChild(fill);
        
        card.appendChild(title);
        card.appendChild(optionsWrap);
        card.appendChild(bar);
        container.appendChild(card);
      }
      
             async function trySupabase() {
         try {
           const res = await fetch('supabase/supabaseConfig.json', { cache: 'no-store' });
           if (!res.ok) {
             console.log('No Supabase config, using localStorage');
             renderLocalStorageContent();
             return;
           }
           
           // Check if we have localStorage content first
           const localGallery = JSON.parse(localStorage.getItem('galleryItems') || '[]');
           const localPolls = JSON.parse(localStorage.getItem('polls') || '[]');
           
           if (localGallery.length > 0 || localPolls.length > 0) {
             console.log('Found localStorage content, using it instead of Supabase');
             renderLocalStorageContent();
             return;
           }
           
           window.USE_SUPABASE = true;
           const gallery = await fetchGallery();
           const polls = await fetchPolls();
           
           // Render gallery
           const grid = document.getElementById('galleryGrid');
           if (grid) {
             grid.innerHTML = '';
             gallery.forEach((item) => renderGalleryItem(item, grid));
           }

           // Render polls
           const list = document.getElementById('pollsList');
           if (list) {
             list.innerHTML = '';
             polls.forEach((poll) => renderPoll(poll, list));
           }
         } catch (error) {
           console.log('Supabase error, falling back to localStorage:', error);
           renderLocalStorageContent();
         }
       }
      
             function renderLocalStorageContent() {
         console.log('Rendering localStorage content...');
         
         // Update status
         const statusEl = document.getElementById('status');
         if (statusEl) {
           const galleryItems = JSON.parse(localStorage.getItem('galleryItems') || '[]');
           const polls = JSON.parse(localStorage.getItem('polls') || '[]');
           statusEl.textContent = `Using localStorage: ${galleryItems.length} gallery items, ${polls.length} polls`;
         }
         
         // Render gallery from localStorage
         const grid = document.getElementById('galleryGrid');
         if (grid) {
           grid.innerHTML = '';
           const items = JSON.parse(localStorage.getItem('galleryItems') || '[]');
           console.log('Gallery items from localStorage:', items);
           items.forEach((item) => renderGalleryItem(item, grid));
         }
         
         // Render polls from localStorage
         const list = document.getElementById('pollsList');
         if (list) {
           list.innerHTML = '';
           const polls = JSON.parse(localStorage.getItem('polls') || '[]');
           console.log('Polls from localStorage:', polls);
           polls.forEach((poll) => renderPoll(poll, list));
         }
       }
      
      // Handle messages from admin panel
      window.addEventListener('message', (event) => {
        if (!event.data || typeof event.data !== 'object') return;
        const { type, payload } = event.data;
        
        if (type === 'updateGallery') {
          localStorage.setItem('galleryItems', JSON.stringify(payload || []));
          renderLocalStorageContent();
        }
        if (type === 'updatePolls') {
          localStorage.setItem('polls', JSON.stringify(payload || []));
          renderLocalStorageContent();
        }
      });
      
             // Force localStorage rendering function
       function forceLocalStorage() {
         console.log('Forcing localStorage rendering...');
         renderLocalStorageContent();
       }
       
       // Initialize
       trySupabase();
    </script>
  </body>
</html> 